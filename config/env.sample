# Refresherr Configuration
# Copy this file to .env and customize for your environment

# ============================================================================
# Configuration File
# ============================================================================
# Path to YAML configuration file (defaults to /config/config.yaml)
CONFIG_FILE=/config/config.yaml

# ============================================================================
# Scan Configuration
# ============================================================================
# Scan interval in seconds (default: 300 = 5 minutes)
# Environment variables have higher precedence than YAML config
# (Precedence: defaults → YAML → env vars)
SCAN_INTERVAL=300

# Dry run mode - set to 'false' to enable actual repairs
# When true, no changes are made to symlinks
DRYRUN=true

# Log level for Refresherr (DEBUG, INFO, WARNING, ERROR)
REFRESHER_LOG_LEVEL=INFO

# Pattern to ignore in scanned paths (optional)
# Files/directories containing this substring will be skipped
IGNORE_SUBSTR=cinesync

# ============================================================================
# Path Configuration
# ============================================================================
# Data directory for database and logs
DATA_DIR=/data

# Legacy symlink root (used by dashboard if config.yaml not available)
# Prefer using scan.roots in config.yaml for multiple roots
SYMLINK_ROOT=/opt/media/jelly

# Legacy mount root check (optional)
MOUNT_ROOT=/mnt/remote/realdebrid

# ============================================================================
# Relay Service Configuration (Single Container)
# ============================================================================
# In single-container mode, the relay runs internally on localhost:5050
# No external URL or authentication needed unless exposing relay externally
RELAY_BASE=http://localhost:5050

# Authentication token for relay service (only needed if exposing externally)
# For internal single-container use, set to 'internal' or leave as default
# If exposing externally, CHANGE THIS to a secure random token
RELAY_TOKEN=internal

# ============================================================================
# Notification Configuration
# ============================================================================
# Discord webhook URL for notifications (optional)
# Get this from Discord: Server Settings > Integrations > Webhooks
DISCORD_WEBHOOK=

# ============================================================================
# Dashboard Configuration
# ============================================================================
# Flask secret key for session management
FLASK_SECRET=change-me-to-random-string

# Dashboard port (default: 8088)
PORT=8088

# ============================================================================
# Advanced Configuration
# ============================================================================
# Custom database path (overrides DATA_DIR/symlinks.db)
# DB_PATH=/data/symlinks.db

# Build/deployment tracking (optional)
# GIT_REV=main

# ============================================================================
# Docker Volume Mapping Examples
# ============================================================================
# When running in Docker, ensure your docker-compose.yml volumes match
# the paths in your config.yaml path_mappings section.
#
# Example docker-compose.yml volumes:
#   - ./config:/config:ro              # Config files (read-only)
#   - ./data:/data                     # Database and logs
#   - /opt/media/jelly:/opt/media/jelly:rw  # Symlink root
#   - /mnt/realdebrid:/mnt/remote/realdebrid:ro  # Actual files
#
# Then in config.yaml path_mappings:
#   - container: /opt/media/jelly
#     logical: /mnt/host-storage/media/jelly
#     description: "Jellyfin symlink root"
#
#   - container: /mnt/remote/realdebrid
#     logical: /mnt/host-storage/realdebrid-mount
#     description: "RealDebrid mount"

# ============================================================================
# Sonarr/Radarr Instance Configuration (Optional)
# ============================================================================
# Configure your Sonarr/Radarr instances for ARR repair functionality
# Multiple instances supported - add as needed

# Sonarr instances
# SONARR_TV_URL=http://sonarr-tv:8989
# SONARR_TV_API=your-api-key-here
# SONARR_ANIME_URL=http://sonarr-anime:8989
# SONARR_ANIME_API=your-api-key-here

# Radarr instances
# RADARR_MOVIE_URL=http://radarr:7878
# RADARR_MOVIE_API=your-api-key-here
# RADARR_4K_URL=http://radarr-4k:7878
# RADARR_4K_API=your-api-key-here

# ============================================================================
# CineSync Configuration (Optional)
# ============================================================================
# Configure CineSync repair to hotswap broken symlinks from your library
# CINESYNC_BASE=/opt/media/jelly/cinesync/CineSync
# CINESYNC_REPAIR_ROOTS=/opt/media/jelly/tv,/opt/media/jelly/movies

# ============================================================================
# CineSync Configuration (Optional)
# ============================================================================
# CineSync is a hotswap repair mechanism that uses an existing media library
# (e.g., your CineSync folder) as a source to repair broken symlinks.
# When enabled, Refresherr can replace broken symlinks by pointing them to
# files in your CineSync library that match the same show/episode.

# Base path to your CineSync library structure
# This should point to the root CineSync folder containing Shows/, Movies/, etc.
# Example: /opt/media/jelly/cinesync/CineSync
CINESYNC_BASE=/opt/media/jelly/cinesync/CineSync

# Comma-separated list of directories to repair (where broken symlinks live)
# These are your "live" media library paths that users access
# Example: /opt/media/jelly/tv,/opt/media/jelly/movies
CINESYNC_REPAIR_ROOTS=/opt/media/jelly/tv,/opt/media/jelly/movies

# Dry-run mode for CineSync repairs (1=dry-run, 0=live repairs)
# When set to 1, CineSync will only log what it would do without making changes
# Set to 0 to enable actual symlink replacement
CINESYNC_DRY_RUN=1

# Maximum number of broken symlinks to attempt per CineSync run
# This prevents runaway repairs and limits resource usage
# Default: 200
CINESYNC_LIMIT=200

# Comma-separated list of allowed target path prefixes for security
# CineSync will ONLY create symlinks pointing to paths starting with these prefixes
# This prevents accidentally linking to unauthorized locations
# Example: /mnt/remote,/mnt/cloud
CINESYNC_ALLOWED_TARGET_PREFIXES=/mnt/remote

# ============================================================================
# Notes
# ============================================================================
# 1. Environment variables override values in config.yaml
# 2. Sensitive data (tokens, webhooks) should be in .env, not config.yaml
# 3. Path mappings help translate between container and host paths
# 4. Use routing in config.yaml to direct symlinks to correct instances
# 5. See README.md for complete configuration guide
